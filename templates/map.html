<!--
You are free to copy and use this sample in accordance with the terms of the
Apache license (http://www.apache.org/licenses/LICENSE-2.0.html)
-->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>Google Maps API Sample</title>
    <script type="text/javascript" src="/media/js/jquery-1.10.1.min.js"></script>
    <script src="/media/js/mapiconmaker.js" type="text/javascript"></script>
    <script src="//maps.google.com/maps?file=api&amp;v=2&amp;sensor=false&amp;key=ABQIAAAAuPsJpk3MBtDpJ4G8cqBnjRRaGTYH6UMl8mADNa0YKuWNNa8VNxQCzVBXTx2DYyXGsTOxpWhvIG7Djw" type="text/javascript"></script>
    <script type="text/javascript">

    function initialize() {
      if (GBrowserIsCompatible()) {
        var map = new GMap2(document.getElementById("map_canvas"), { size: new GSize(640,640)});
        map.setMapType(G_SATELLITE_MAP);
        map.setCenter(new GLatLng(38.066583,23.998196), 17);
        map.removeMapType(G_HYBRID_MAP);
        map.addControl(new GMapTypeControl());
        map.addControl(new GSmallMapControl());
    // Creates a marker at the given point
    // Clicking the marker will hide it
        function getIcon(color) {
            return MapIconMaker.createMarkerIcon({width: 20, height: 34, primaryColor: color, cornercolor:color});
        }
        function createMarker(appartment, info) {
          var latlng = new GLatLng(info["lat"], info["lng"])
          var whiteIcon = new GIcon(G_DEFAULT_ICON);
          whiteIcon.image = "/media/mapicons/white/number_1.png";

          // Set up our GMarkerOptions object
          switch(info["status"]) {
            case "PENDING":
              color = "#FFFF00";
              break;
            case "CONFIRMED":
              color = "#FF0000";
              break;
            default:
              color = "#0080000";
          }
          markerOptions = { icon:getIcon(color) };
          var marker = new GMarker(latlng, markerOptions);
          marker.value = appartment;
          GEvent.addListener(marker,"click", function() {
            var myHtml = "<b>" + appartment + "</b><br>" + info["reservation"];
            map.openInfoWindowHtml(latlng, myHtml);
          });
          return marker;
        }
        GEvent.addListener(map,"click", function(overlay, latlng) {     
              if (latlng) {   
                map.addOverlay(createMarker(latlng, "test"));
              }
            });
        $.getJSON("/media/latlng.json", function(json) {
            console.log(json); // this will show the info it in firebug console 
            for(var appartment in json){
                if (json.hasOwnProperty(appartment)){
                  var info=json[appartment];
                  map.addOverlay(createMarker(appartment, info))
                  // work with key and value
                }
            }
        });
        var polygon = new GPolygon([
          new GLatLng(38.06805096289384, 23.998080790042877),
          new GLatLng(38.0679453804803, 23.998182713985443),
          new GLatLng(38.0680572978338, 23.998381197452545),
          new GLatLng(38.068034069717896, 23.998413383960724),
          new GLatLng(38.06821144787057, 23.998713791370392),
          new GLatLng(38.068287466947176, 23.998644053936005),
          new GLatLng(38.068186108160795, 23.998440206050873),
          new GLatLng(38.068452174675535, 23.998204171657562),
          new GLatLng(38.068403607050605, 23.998078107833862),
          new GLatLng(38.06819877801677, 23.99825781583786),
          new GLatLng(38.06805096289384, 23.998080790042877),
        ], "#f33f00", 5, 1, "#ff0000", 0.2);
        GEvent.addListener(polygon, "click", function() {     
                map.openInfoWindowHtml(new GLatLng(38.06805096289384, 23.998080790042877), "M3");
            });
        map.addOverlay(polygon);
      }
    }

    </script>
  </head>
  <body onload="initialize()" onunload="GUnload()" style="font-family: Arial;border: 0 none;">
    <div id="map_canvas" style="width: 500px; height: 300px"></div>
  </body>
</html>
